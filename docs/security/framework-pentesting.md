# üéØ Framework-Specific Penetration Testing

## Overview

NjordScan's **pentest mode** provides aggressive, runtime security testing with two complementary approaches:

1. **Framework-Specific Tests** - Targeted vulnerabilities in **React**, **Next.js**, and **Vite**
2. **Generic Form Tests** - Traditional DAST for SQL injection, XSS, and command injection

This dual approach ensures comprehensive coverage whether you're testing a modern framework or traditional web forms.

‚ö†Ô∏è **WARNING**: Pentest mode sends exploit payloads and should ONLY be used on systems you own or have explicit written permission to test. Unauthorized pentesting is illegal.

## What Pentest Mode Tests

### üéØ Two-Layer Testing Approach

**Layer 1: Framework-Specific**
- Tests modern JavaScript frameworks with targeted exploits
- Detects framework automatically (Next.js, Vite, React)
- Focuses on SSR, API routes, HMR, and framework patterns

**Layer 2: Generic Form Testing**
- Discovers all forms on the page
- Tests each form for SQL injection, XSS, and command injection
- Works on any framework including legacy applications

### üîπ Next.js Applications

**API Route Security**
- Authentication bypass attempts on `/api/*` endpoints
- Authorization checks for admin routes
- Input validation in API handlers
- SQL injection and command injection in API routes

**Server-Side Rendering (SSR)**
- XSS in `getServerSideProps` with reflected payloads
- HTML injection in server-rendered content
- Hydration mismatch exploits

**Image Optimization**
- SSRF via `/_next/image` endpoint
- Internal network access attempts
- Cloud metadata endpoint access

**Middleware Exploits**
- Path traversal to bypass middleware
- URL encoding bypass techniques
- Route protection circumvention

**Example Tests:**
```bash
# Test Next.js API routes
GET /api/users         # Attempt unauthorized access
GET /api/admin         # Test for missing auth
POST /api/data         # Test input validation

# Test SSR XSS
GET /?search=<script>alert(1)</script>
GET /?name="><img src=x onerror=alert(1)>

# Test Image SSRF
GET /_next/image?url=http://127.0.0.1:8080
GET /_next/image?url=http://169.254.169.254/latest/meta-data/

# Test Middleware Bypass
GET /admin/..%2fadmin
GET /dashboard?admin=true
```

### üîπ Vite Applications

**Hot Module Replacement (HMR)**
- Exposed HMR WebSocket connections
- Development endpoints in production
- Source map exposure

**File System Access**
- `/@fs/` endpoint exploitation
- Path traversal attempts
- Unauthorized file reads

**Environment Variables**
- `.env` file exposure
- `VITE_*` variable leaks
- API key exposure in client bundles

**Build Configuration**
- Misconfigured CORS policies
- Insecure dev server settings
- Plugin security issues

**Example Tests:**
```bash
# Test HMR endpoints
GET /@vite/client      # Check for dev mode
GET /__vite_ping       # Development server detection
GET /@fs/              # File system access

# Test environment exposure
GET /.env              # Environment file access
GET /.env.local
GET /.env.production

# Test file system
GET /@fs//etc/passwd   # Linux path traversal
GET /@fs/C:/Windows/System32/drivers/etc/hosts  # Windows

# Test source maps
GET /assets/index.js.map
GET /dist/index.js.map
```

### üîπ React Applications

**Client-Side Routing**
- Open redirect vulnerabilities
- Unvalidated navigation parameters
- JavaScript protocol injection

**State Management**
- XSS via `localStorage`/`sessionStorage`
- Sensitive data in client state
- Redux/Context injection

**Component Security**
- `dangerouslySetInnerHTML` XSS
- Unsafe prop injection
- Dynamic script loading

**API Integration**
- Unprotected API endpoints
- Missing authentication checks
- Data exposure in responses

**Example Tests:**
```bash
# Test open redirects
GET /?redirect=javascript:alert(1)
GET /?next=//evil.com
GET /?return=http://attacker.com

# Test state XSS
GET /?user=<img src=x onerror=alert(1)>
GET /?data=<script>alert(1)</script>

# Test dangerouslySetInnerHTML
GET /?content=<script>alert(1)</script>
GET /?html=<img src=x onerror=alert(1)>

# Test API exposure
GET /api/
GET /graphql
GET /rest/
```

## Usage

### Enable Pentest Mode

```bash
# Scan with framework-specific pentest
python -m njordscan scan http://localhost:3000 --pentest

# Specify framework explicitly
python -m njordscan scan http://localhost:3000 --pentest --framework nextjs

# Pentest with verbose output
python -m njordscan scan http://localhost:3000 --pentest --verbose
```

### Ethical Consent Required

When you run `--pentest`, you'll be prompted with a legal warning:

```
‚ö†Ô∏è  PENTEST MODE WARNING ‚ö†Ô∏è

Pentest mode enables aggressive framework-specific security testing that may:
  ‚Ä¢ Test React, Next.js, and Vite apps with exploit payloads
  ‚Ä¢ Attempt authentication bypasses and middleware exploits
  ‚Ä¢ Trigger security monitoring systems

Only use pentest mode on systems you own or have explicit permission to test.

Do you have permission to test this target? (y/N):
```

You must accept this warning to proceed.

## Framework Detection

Pentest mode automatically detects the framework at runtime:

**Next.js Detection:**
- `/_next/` directory presence
- `__NEXT_DATA__` in page source
- `x-powered-by: Next.js` header

**Vite Detection:**
- `/@vite/` directory presence
- Vite client markers in source
- HMR connection indicators

**React Detection:**
- React root markers (`data-reactroot`)
- React in page source
- No Next.js indicators

## Generic Form Testing

In addition to framework-specific tests, pentest mode automatically:

1. **Discovers all HTML forms** on the target page
2. **Tests each form** for SQL injection, XSS, and command injection
3. **Works with any backend** - PHP, Python, Ruby, Node.js, etc.

This means you get comprehensive coverage whether testing:
- Modern React/Next.js/Vite apps
- Traditional server-side frameworks
- Hybrid applications
- Legacy systems

**Example: Form Testing in Action**
```bash
# Page has a login form
<form action="/login" method="POST">
  <input name="username">
  <input name="password">
</form>

# Pentest mode will automatically test:
POST /login
  username=admin'-- (SQL injection)
  password=<script>alert(1)</script> (XSS)
  
POST /login
  username=' OR '1'='1 (SQL injection)
  password=; whoami (Command injection)
```

## Safety Features

### Rate Limiting
- Built-in delays between requests (0.5-1 second)
- Limited payload sets (2-3 payloads per test)
- Concurrent request limits

### Scope Restriction
- Only framework-specific tests run
- No database/OS-level exploits
- Focused on web framework vulnerabilities

### Timeout Protection
- 5-second timeout per request
- Automatic failure handling
- Non-destructive testing only

## Best Practices

### ‚úÖ DO:
- **Get written permission** before pentesting
- Use on **staging/development** environments first
- **Document all findings** immediately
- **Notify system owners** of critical issues
- Run pentest during **maintenance windows**

### ‚ùå DON'T:
- Test production systems without approval
- Run pentest on third-party websites
- Use pentest for malicious purposes
- Share credentials obtained during testing
- Overwhelm systems with excessive requests

## Legal Disclaimer

**READ CAREFULLY:** Using pentest mode without authorization is illegal and may result in:
- Criminal prosecution under computer fraud laws
- Civil liability for damages
- Loss of access and prosecution

**You are solely responsible** for:
- Obtaining proper authorization
- Ensuring legal compliance
- Any damage or disruption caused
- Securing any discovered vulnerabilities

NjordScan developers accept **NO LIABILITY** for misuse of pentest mode.

## Reporting Findings

When you discover vulnerabilities using pentest mode:

1. **Document the finding**
   - Save the scan report
   - Screenshot the vulnerability
   - Note exact reproduction steps

2. **Verify it's not a false positive**
   - Reproduce manually if possible
   - Check framework documentation
   - Consult security advisories

3. **Report responsibly**
   - Notify the system owner immediately for critical issues
   - Follow responsible disclosure timelines
   - Provide clear reproduction steps

4. **Remediate quickly**
   - Apply fixes recommended by NjordScan
   - Test fixes in staging first
   - Re-scan to verify remediation

## Framework-Specific Remediation

### Next.js
```javascript
// ‚ùå Vulnerable API Route
export default function handler(req, res) {
  const users = getAllUsers();
  res.json(users);
}

// ‚úÖ Secure API Route
import { requireAuth } from '@/lib/auth';

export default async function handler(req, res) {
  const user = await requireAuth(req);
  if (!user || user.role !== 'admin') {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  const users = getAllUsers();
  res.json(users);
}
```

### Vite
```javascript
// vite.config.js - Secure configuration
export default defineConfig({
  server: {
    fs: {
      strict: true,  // Prevent /@fs/ access
      allow: ['..']  // Whitelist allowed directories
    },
    host: false,     // Don't bind to 0.0.0.0
    cors: false      // Disable CORS in production
  },
  build: {
    sourcemap: false // Disable source maps in production
  }
});
```

### React
```jsx
// ‚ùå Vulnerable
<div dangerouslySetInnerHTML={{__html: userInput}} />

// ‚úÖ Secure
import DOMPurify from 'dompurify';
<div dangerouslySetInnerHTML={{
  __html: DOMPurify.sanitize(userInput)
}} />
```

## See Also

- [Vulnerability Types](vulnerability-types.md) - Comprehensive vulnerability reference
- [CLI Reference](../user-guide/cli-reference.md) - All command-line options
- [Legal Disclaimer](../../LICENSE) - Full legal terms

---

**Remember:** With great power comes great responsibility. Use pentest mode ethically and legally. üõ°Ô∏è
